#!/bin/bash
apt-get update
apt-get install -y nginx openssl

# Création d'un certificat auto-signé
mkdir -p /etc/nginx/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/nginx/ssl/nginx.key \
    -out /etc/nginx/ssl/nginx.crt \
    -subj "/C=FR/ST=PACA/L=Nice/O=Security/CN=backend.local"

# Configuration Nginx minimaliste avec TLS 1.2 uniquement
cat > /etc/nginx/sites-available/default <<EOF
server {
    listen 80;
    listen 443 ssl;
    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    
    # FORCING TLS 1.2 ONLY
    ssl_protocols TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        add_header Content-Type text/plain;
        return 200 'Bravo ! Vous avez atteint le Backend TLS 1.2 via FortiGate.';
    }
}
EOF

systemctl restart nginx
